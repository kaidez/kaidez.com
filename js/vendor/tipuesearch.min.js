(function($){$.fn.tipuesearch=function(options){var set=$.extend({show:7,newWindow:!1,showURL:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json"},options);return this.each(function(){function getURLP(name){return decodeURIComponent((RegExp("[?|&]"+name+"="+"([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function getTipueSearch(start,replace){$("#tipue_search_content").hide();var out="",show_replace=!1,show_stop=!1,d=$("#tipue_search_input").val().toLowerCase();d=$.trim(d);var d_w=d.split(" ");d="";for(var i=0;d_w.length>i;i++){for(var a_w=!0,f=0;tipuesearch_stop_words.length>f;f++)d_w[i]==tipuesearch_stop_words[f]&&(a_w=!1,show_stop=!0);a_w&&(d=d+" "+d_w[i])}if(d=$.trim(d),d_w=d.split(" "),d.length>=set.minimumLength){if(replace){for(var d_r=d,i=0;d_w.length>i;i++)for(var f=0;tipuesearch_replace.words.length>f;f++)d_w[i]==tipuesearch_replace.words[f].word&&(d=d.replace(d_w[i],tipuesearch_replace.words[f].replace_with),show_replace=!0);d_w=d.split(" ")}for(var d_t=d,i=0;d_w.length>i;i++)for(var f=0;tipuesearch_stem.words.length>f;f++)d_w[i]==tipuesearch_stem.words[f].word&&(d_t=d_t+" "+tipuesearch_stem.words[f].stem);d_w=d_t.split(" ");var c=0;found=[];for(var i=0;tipuesearch_in.pages.length>i;i++){for(var score=1e9,s_t=tipuesearch_in.pages[i].text,f=0;d_w.length>f;f++){var pat=RegExp(d_w[f],"i");if(-1!=tipuesearch_in.pages[i].title.search(pat)&&(score-=2e5-i),-1!=tipuesearch_in.pages[i].text.search(pat)&&(score-=15e4-i),set.highlightTerms){if(set.highlightEveryTerm)var patr=RegExp("("+d_w[f]+")","gi");else var patr=RegExp("("+d_w[f]+")","i");s_t=s_t.replace(patr,"<em>$1</em>")}-1!=tipuesearch_in.pages[i].tags.search(pat)&&(score-=1e5-i)}1e9>score&&(found[c++]="static-images"==set.mode?score+"^"+tipuesearch_in.pages[i].title+"^"+s_t+"^"+tipuesearch_in.pages[i].loc+"^"+tipuesearch_in.pages[i].image:score+"^"+tipuesearch_in.pages[i].title+"^"+s_t+"^"+tipuesearch_in.pages[i].loc)}if(0!=c){1==show_replace&&(out+='<div id="tipue_search_warning_head">Showing results for '+d+"</div>",out+='<div id="tipue_search_warning">Show results for <a href="javascript:void(0)" id="tipue_search_replaced">'+d_r+"</a></div>"),1==c?out+='<div id="tipue_search_results_count">1 result</div>':(c_c=(""+c).replace(/\B(?=(\d{3})+(?!\d))/g,","),out+='<div id="tipue_search_results_count">'+c_c+" results</div>"),found.sort();for(var l_o=0,i=0;found.length>i;i++){var fo=found[i].split("^");if(l_o>=start&&set.show+start>l_o){out+='<div class="tipue_search_content_title"><a href="'+fo[3]+'"'+tipue_search_w+">"+fo[1]+"</a></div>","static-images"==set.mode&&fo[4]&&(out+='<div class="tipue_search_content_image_box"><img class="tipue_search_content_image" id="'+fo[1]+"^"+fo[3]+'" ',out+="src="+fo[4]+'></div><div style="clear: both;"></div>');var t=fo[2],t_d="",t_w=t.split(" ");if(t_w.length<set.descriptiveWords)t_d=t;else for(var f=0;set.descriptiveWords>f;f++)t_d+=t_w[f]+" ";t_d=$.trim(t_d),"."!=t_d.charAt(t_d.length-1)&&(t_d+=" ..."),out+='<div class="tipue_search_content_text">'+t_d+"</div>",set.showURL&&(out+='<div class="tipue_search_content_loc"><a href="'+fo[3]+'"'+tipue_search_w+">"+fo[3]+"</a></div>")}l_o++}if(c>set.show){var pages=Math.ceil(c/set.show),page=start/set.show;if(out+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',start>0&&(out+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(start-set.show)+"_"+replace+'">&#171; Previous</a></li>'),4>=page){var p_b=pages;pages>5&&(p_b=5);for(var f=0;p_b>f;f++)out+=f==page?'<li class="current">'+(f+1)+"</li>":'<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+f*set.show+"_"+replace+'">'+(f+1)+"</a></li>"}else{var p_b=pages+4;p_b>pages&&(p_b=pages);for(var f=page;p_b>f;f++)out+=f==page?'<li class="current">'+(f+1)+"</li>":'<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+f*set.show+"_"+replace+'">'+(f+1)+"</a></li>"}page+1!=pages&&(out+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(start+set.show)+"_"+replace+'">Next &#187;</a></li>'),out+="</ul></div>"}}else out+='<div id="tipue_search_warning_head">Nothing found</div>'}else show_stop?out+='<div id="tipue_search_warning_head">Nothing found</div><div id="tipue_search_warning">Common words are largely ignored</div>':(out+='<div id="tipue_search_warning_head">Search too short</div>',out+=1==set.minimumLength?'<div id="tipue_search_warning">Should be one character or more</div>':'<div id="tipue_search_warning">Should be '+set.minimumLength+" characters or more</div>");$("#tipue_search_content").html(out),$("#tipue_search_content").slideDown(200),$("#tipue_search_replaced").click(function(){getTipueSearch(0,!1)}),$(".tipue_search_content_image").click(function(){var src_i=$(this).attr("src"),id_v=$(this).attr("id"),id_a=id_v.split("^"),l_c_i='<img src="'+src_i+'"><div id="tipue_lightbox_content_title">'+id_a[0]+"</div>";if(l_c_i+='<a href="'+id_a[1]+'"'+tipue_search_w+'><div id="tipue_lightbox_content_link"></div></a>',l_c_i+='<a href="'+src_i+'"'+tipue_search_w+'><div id="tipue_lightbox_content_expand"></div></a><div style="clear: both;"></div>',$("#tipue_lightbox").length>0)$("#tipue_lightbox_content").html(l_c_i),$("#tipue_lightbox").fadeIn();else{var tipue_lightbox='<div id="tipue_lightbox"><div id="tipue_lightbox_content">'+l_c_i+"</div></div>";$("body").append(tipue_lightbox),$("#tipue_lightbox").fadeIn()}}),$("#tipue_lightbox").live("click",function(){$("#tipue_lightbox").hide()}),$(".tipue_search_foot_box").click(function(){var id_v=$(this).attr("id"),id_a=id_v.split("_");getTipueSearch(parseInt(id_a[0]),id_a[1])})}var tipuesearch_in={pages:[]};if($.ajaxSetup({async:!1}),"live"==set.mode)for(var i=0;tipuesearch_pages.length>i;i++)$.get(tipuesearch_pages[i],"",function(html){var cont=$(set.liveContent,html).text();cont=cont.replace(/\s+/g," ");var desc=$(set.liveDescription,html).text();desc=desc.replace(/\s+/g," ");var t_1=html.toLowerCase().indexOf("<title>"),t_2=html.toLowerCase().indexOf("</title>",t_1+7);if(-1!=t_1&&-1!=t_2)var tit=html.slice(t_1+7,t_2);else var tit="No title";tipuesearch_in.pages.push({title:tit,text:desc,tags:cont,loc:tipuesearch_pages[i]})});"json"==set.mode&&$.getJSON(set.contentLocation,function(json){tipuesearch_in=$.extend({},json)}),("static"==set.mode||"static-images"==set.mode)&&(tipuesearch_in=$.extend({},tipuesearch));var tipue_search_w="";set.newWindow&&(tipue_search_w=' target="_blank"'),getURLP("q")&&($("#tipue_search_input").val(getURLP("q")),getTipueSearch(0,!0)),$("#tipue_search_button").click(function(){getTipueSearch(0,!0)}),$(this).keyup(function(event){"13"==event.keyCode&&getTipueSearch(0,!0)})})}})(jQuery);